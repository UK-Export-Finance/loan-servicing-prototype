{% extends "index.njk" %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/date-input/macro.njk" import govukDateInput %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}
{% from "govuk/components/table/macro.njk" import govukTable %}

{% block pageTitle -%}
  Facility
  {{ facility.streamId }}
{%- endblock %}

{% block content %}
  {% if facilityCreated %}
    {% set html %}
    <p class="govuk-notification-banner__heading">
      Facility created successfully
    </p>
    {% endset %}

    {{ govukNotificationBanner({
      html: html,
      type: 'success'
    }) }}
  {% endif %}
  <h1 class="govuk-heading-l">Facility
    {{ facility.streamId }}</h1>
  <p class="govuk-body govuk-!-margin-bottom-6">Obligor:
    {{facility.obligor}}</p>
  <p class="govuk-body govuk-!-margin-bottom-6">Facility Amount:
    Â£{{facility.facilityAmount}}</p>
  <p class="govuk-body govuk-!-margin-bottom-6">Interest Rate:
    {{facility.interestRate}}%</p>
  <p class="govuk-body govuk-!-margin-bottom-6">Start Date:
    {{facility.issuedEffectiveDate|parseDate}}</p>
  <p class="govuk-body govuk-!-margin-bottom-6">End Date:
    {{facility.expiryDate|parseDate}}</p>

  <h2 class="govuk-heading-m">Edit Facility</h2>
  <h3 class="govuk-heading-s">Facility Amount</h3>
    <form action="/facility/{{facility.streamId}}/adjustPrincipal?version={{facility.streamVersion}}" method="post">
    {{ govukInput({
        label: {
          text: "Adjust facility amount"
        },
        classes: "govuk-input--width-20",
        id: "adjustment",
        name: "adjustment"
      }) }}
    {{ govukDateInput({
        id: "effectiveDate",
        namePrefix: "effectiveDate",
        fieldset: {
          legend: {
            text: "Effective date of adjustment"
          }
        }
      }) }}
    {{ govukButton({  text: "Add adjustment"}) }}
  </form>
  <h3 class="govuk-heading-s">Interest Rate</h3>
    <form action="/facility/{{facility.streamId}}/updateInterest?version={{facility.streamVersion}}" method="post">
    {{ govukInput({
        label: {
          text: "Updated Interest Value (%)"
        },
        classes: "govuk-input--width-20",
        id: "interestRate",
        name: "interestRate"
      }) }}
    {{ govukDateInput({
        id: "effectiveDate",
        namePrefix: "effectiveDate",
        fieldset: {
          legend: {
            text: "Effective date of adjustment"
          }
        }
      }) }}
    {{ govukButton({  text: "Add adjustment"}) }}
  </form>

  {{ govukTable({
    caption: "Facility Transactions",
    captionClasses: "govuk-table__caption--m",
    head: [
      {
        text: "Date"
      },
      {
        text: "Reference"
      },
      {
        text: "Transaction Amount"
      },
      {
        text: "Balance"
      }
    ],
    rows: transactionRows
  }) }}

  {{ govukTable({
    caption: "Event History",
    captionClasses: "govuk-table__caption--m",
    head: [
      {
        text: "Event Date"
      },
      {
        text: "Action"
      },
      {
        text: "Changes"
      },
      {
        text: "Effective Date"
      }
    ],
    rows: eventRows
  }) }}

{% endblock %}